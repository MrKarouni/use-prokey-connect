<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ProkeyConnect | Prokey</title>
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="author" content="Prokey info@prokey.io" />
    <meta name="robots" content="index, follow" />
    <meta name="title" content="Prokey Connect" />
    <script type="text/javascript" src="./js/trezor-connect.63a01bc7a7ca2e156d70.js"></script>
    <script type="text/javascript">
        var TrezorConnect = window.TrezorConnect;
        console.log('init my test use');

        TrezorConnect.on('DEVICE_EVENT', (event) => {
            if (event.type === 'device-connect') {
                console.log('Prokey Connected Event : ', event);
            } else if (event.type === 'device-disconnect') {
                console.log('Prokey Disconnected Event : ', event);
            } else if (event.type == 'device-changed') {
                console.log('Prokey Device Change Event : ', event);
            }
        });

        async function trezor_init() {
            try {
                await TrezorConnect.init({
                    configSrc: './data/config.json',
                    debug: false,
                    origin: 'localhost',
                    priority: 0,
                    trustedHost: true,
                    connectSrc: '',
                    iframeSrc: 'iframe.html',
                    popup: false,
                    popupSrc: 'popup.html',
                    webusbSrc: 'webusb.html',
                    transportReconnect: false,
                    webusb: false,
                    pendingTransportEvent: true,
                    supportedBrowser: true,
                    extension: null,
                });
                console.log('trezor init done.');
            } catch (error) {
                console.log('error darim : ', error);
            }
        }

        async function trezor_getPublicKey() {
            TrezorConnect.getPublicKey({ coin: 'btn', path: "m/49'/0'/0'/0/0" }).then(
                result => {
                    console.log('Trezor result (pk) : ', result);
                }
            );
        }

        async function init() {
            try {
                await TrezorConnect.initProkey({
                    configSrc: './data/config.json',
                    debug: false,
                    origin: 'localhost',
                    priority: 0,
                    trustedHost: true,
                    connectSrc: '',
                    iframeSrc: 'iframe.html',
                    popup: false,
                    popupSrc: 'popup.html',
                    webusbSrc: 'webusb.html',
                    transportReconnect: false,
                    webusb: false,
                    pendingTransportEvent: true,
                    supportedBrowser: true,
                    extension: null,
                });
                console.log('prokey init done.');
            } catch (error) {
                console.log('error darim : ', error);
            }
        }

        async function getPublicKey() {
            try {
                await TrezorConnect.callProkey({ method: 'getPublicKey', coin: 'btc', path: "m/49'/0'/0'/0/0" }).then
                    (result => {
                        console.log('call use result : ', result);
                    });
                console.log('prokey call finished.');
            } catch (error) {
                console.log('error in use prokey call : ', error);
            }
        }

        async function getAddress() {
            try {
                await TrezorConnect.callProkey({ method: 'getAddress', coin: 'btc', path: "m/49'/0'/0'/0/0" }).then(result => {
                    console.log('get Address result : ', result);
                });
            } catch (error) {
                console.log('error in use prokey get address : ', error);
            }
        }
    </script>
</head>

<body>
    <h1>Prokey Connect</h1>
    <div class="device-status"></div>
    <div class="label"></div>
    <button type="button" onclick="trezor_init();">Init Trezor</button>
    <button type="button" onclick="trezor_getPublicKey();">Trezor - getPublicKey</button>
    <button type="button" onclick="init();">Init Prokey</button>
    <button type="button" onclick="getPublicKey();">Call Prokey - getPublicKey</button>
    <button type="button" onclick="getAddress();">Call Prokey - getAddress</button>
    <div class="public-key"></div>
    <div class="address"></div>
</body>

</html>